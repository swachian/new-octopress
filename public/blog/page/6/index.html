
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hegel2011的博客</title>
  <meta name="author" content="Hegel 2011">

  
  <meta name="description" content="http://tutor.lugolabs.com/articles/18-handling-csv-views-in-ruby-on-rails 确实扩展的够方便，实施的够优雅。
">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://octopresszhangyu.herokuapp.com/blog/page/6/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Hegel2011的博客" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Hegel2011的博客</a></h1>
  
    <h2>读书 - 工作 - 生活 - 笔记</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:octopresszhangyu.herokuapp.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">关于自己</a></li>
  <li><a href="/blog/2015/02/20/to-read-list/">To-Read</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/01/guan-yu-handling-rails-viewde-shen-zuo/">关于handling Rails View的神作</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-01T22:25:00+08:00" pubdate data-updated="true">Aug 1<span>st</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>http://tutor.lugolabs.com/articles/18-handling-csv-views-in-ruby-on-rails</p>

<p>确实扩展的够方便，实施的够优雅。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/24/wei-shi-yao-che-pai-huan-hao-bu-yong-qu-yan-che/">为什么车牌换号不用去验车</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-24T21:26:00+08:00" pubdate data-updated="true">Jul 24<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>上海由于车牌最早拍卖的缘故，所以一直允许换车的时候可以保留原号牌。也算是一种对私人财产的尊重。
这次买车，一直不太理解为什么重新换个号不需要开车去验车，但保留原号就必须去验车。</p>

<p>后来跟师傅了解了一下，原因倒是也很简单，更换新号码的话是可以在4S的社会上牌点搞定的，
而保留原号码这必须到交管所才能办理，交管所的办理新牌又是要新车上门验车的。实际上如果你是去交管所上
新的牌照号码，也是要验车。是否需要验车和是否要保留号码没有直接关系，是由在哪里办理决定的。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/22/ji-yu-oauthde-api-tokensheng-cheng/">基于OAuth的API Token生成</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-22T16:00:00+08:00" pubdate data-updated="true">Jul 22<span>nd</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>基本思路是对方要先注册一下，<strong>注册的时候提供回调地址</strong>，服务平台生成一个<strong>id</strong>给该用户。</p>

<p>然后，用户用这个id来访问平台公开的认证链接，平台生成<strong>code</strong>并通过注册时提供的<strong>回调地址</strong>发送给对方。</p>

<p>对方最后根据code到<strong>token</strong>获取地址拿到实际的token内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  "access_token":"01234567-89ab-cdef-0123-456789abcdef",
</span><span class='line'>  "expires_in":28799,
</span><span class='line'>  "refresh_token":"01234567-89ab-cdef-0123-456789abcdef",
</span><span class='line'>  "token_type":"Bearer",
</span><span class='line'>  "user_id":"01234567-89ab-cdef-0123-456789abcdef",
</span><span class='line'>  "session_nonce":"2bf3ec81701ec291"
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/03/2015kuan-ben-tian-cr-v-2-dot-4liang-qu-ban-ru-shou/">2015款本田CR-V 2.4两驱版入手</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-03T15:39:00+08:00" pubdate data-updated="true">Jul 3<span>rd</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这次买车和一年多前买天籁已经完全不一样了。那时候对驾车用车并没有多少了解，总以为车是越大越舒服，
而实际当上司机之后，开始明白大车其实在上海开顾忌的东西多，停车也不方便，尽管车子本身的品质还是很好的。
对自己需要什么，什么开起来方便不再是懵懵懂懂的，有了较明确的想法。而里面最关键的一条就是不要比凯越长，
这属于整个购车的核心需求。</p>

<p>整个看车的过程持续的很长。从去年9月<a href="/blog/2014/09/10/you-dian-wu-liao-de-qi-che-fa-bu-hui/">缤智、昂科威准备发布开始</a>，备选名单可以有一长串，主要就是<a href="/blog/2014/09/30/yi-kuan-jin-qi-bi-jiao-guan-zhu-de-che-bin-zhi-vezel/">缤智、昂科威、换代逍客</a>，<a href="/blog/2014/10/18/ding-jie-huan-suan-he-li-de-lei-ke-sa-si-nx/">nx200</a>，再到<a href="/blog/2015/04/18/xin-kuan-crvhe-q3/">X1, Q3</a>以及<a href="/blog/2015/04/20/crv/">CR-V, RAV4</a>。</p>

<p>可以说把大部分国内销售的suv，35w以下的都考察过了。整个pk历程如下：</p>

<ul>
<li>缤智

<ul>
<li>9月发布时就看中了，但我不喜欢1.8排量的发动机，倾向于1.5直喷地球梦的，但后来3月底出来的1.5L的配置有太低了，于是放弃</li>
</ul>
</li>
<li>换代逍客

<ul>
<li>这个不提了，至今我仍然认为是最合适的，只是逍客可能要11月才上市，9月份是赶不上了，只能放弃</li>
</ul>
</li>
<li>昂科威

<ul>
<li>尺寸略微大了些，4米6多了。老婆还是认为太像GL8，而新出的1.5T又是搭配双离合的，于是放弃</li>
</ul>
</li>
<li>X1

<ul>
<li>认识的熟人说不好，家里也不想我们买bba，于是放弃</li>
</ul>
</li>
<li>Q3

<ul>
<li>优惠很多但服务费也很高，无试驾车，销售也比较傲慢，同属bba，也放弃了</li>
</ul>
</li>
<li>Nx200

<ul>
<li>虽然定价都还算合理，但2.0的版本配置太差，2.0T的价格还是有点高，小区停车环境也不好，不太舍得停那么贵的车，放弃</li>
</ul>
</li>
<li>RAV4

<ul>
<li>最后其实主要就是RAV4 pk CRV</li>
<li>试驾后不喜欢RAV4的A柱和方向盘转向，尽管其动力总成确实够强悍</li>
<li>无后排空调出风口、后备箱突出来一块也不爽，最后还是放弃了</li>
</ul>
</li>
<li>CRV

<ul>
<li>最大的原因是因为CRV在15年4月进行了大改款，而正好和我的购车周期碰上了，毕竟买新不买旧</li>
<li>2.4的地球梦直喷发动机也很馋人，而CVT试驾后感觉还是很轻快，至少也让我满意</li>
<li>新加的一些配置还是挺吸引人的，比如日行灯带、胎压校验、DA屏、蓝牙、发动机启停、并线辅助</li>
</ul>
</li>
</ul>


<p>上面还有3款销量很出色的SUV没有提到，途观、奇骏和翼虎。不选奇骏的理由很简单，已经有天籁了，同一品牌下的，实在太类似了不想再买一部几乎一样的车子。途观和翼虎没考虑的原因有点个性化，周边买的人太多了，老婆直接就给否了。莫非如此，奇骏、途观至少会比RAV4让我更加纠结买什么。 <br/>
而CRV的样子、品牌、尺寸、动力也让全家人达成了一致，所以很顺利地就下单提车了。
配置的选择也比较简单。肯定是要2.4地球梦发动机的，倾向于不要四驱系统，因为城市里开着没用反而增加上百斤的重量。而2.4顶配多的电动尾门和HID大灯对我的吸引力有限，如果是自动大灯的话可能又要纠结一番。所以直接选定2.4两驱。基本上该有的也有了，没有的再升级也没用。</p>

<p>两天开下来的驾驶感受。好的方面来讲，crv的开车压力还是比较小的，反光镜很大，视野也很好，车头很短所以看左右边距、转弯都比较轻松，方向盘很轻松，确实很好开。我感觉和4米5多一点的A级车驾驶感受更接近些，比开B级车的压力小。</p>

<p>不好的方面，发动机启停很鸡肋，每次上去都要关。这个倒也开始习惯了。
另一个不太习惯的地方是松刹车的时候总有声响。有人说是自动变速箱都有的特性，有人说是本田特色，还有说新车都这样。好吧，看看几个月后车子是否会改善。</p>

<p>方向盘倒是很好。怠速挪车时，方向盘很轻盈，速度起来之后方向盘又会加重，转起来都很舒适。
方向盘上的多功能按钮用起来也很爽，切换电台、切换里程信息、接听电话等都已十分方便。</p>

<p>配置上，还是有点无奈了，手动的东西多了些。比如无自动大灯，无感应雨刷，无自动落锁。比起B级轿车，SUV的配置始终是个短板.</p>

<p>137mm离地间隙是满载，大部分时候是不止的。正面上下马路很轻松，完全没压力。
目前来讲真正让我不满的主要是2点：
1. 倒车扭力太弱，屁股要直着倒进很小坡度的斜坡都要大脚轰油门到3000转。
2. DA屏很鸡肋，基本用不起来。</p>

<p>其他的都是小问题或者以后可能会好。比如松刹车时有格叽的声音（非自动启停），无法在停车场用遥控钥匙让车子发出声音提示车子所在方位（据说本田的车都这样，雅阁思域也这样子）。</p>

<p>另外就是配置少，这个只是看厂家的选择了，但是顶配也没自动大灯，没自动落锁，有自动启停却无电子驻车。可能，这对于一款日系家用suv来讲要求太多了。最大的缺点我目前认为还是倒车太无力，大脚轰油门是有很大隐患的。</p>

<p>总体说来，开起来还是挺开心的一款SUV。</p>

<h2>Updated on 2015.08.12</h2>

<p>目前大陆地区最好的车评人颜宇鹏在今天语音评价了CRV约10分钟，尽管他的评价比老款高，但打分却从原来的9分降到了8.5分。不过他介绍的优缺点基本还算靠谱。除了松刹车响的毛病没说之外，其他基本挺全面了。听写记录如下：</p>

<p>前后车门开关的质感差，[x]<br/>
发动机点火后声音挺安静，怠速很平稳<br/>
过减速带动作非常好，好过9代雅阁、杰德等<br/>
上坡中间响应好，动力能渐进增加，大部分cvt上坡时做不到<br/>
自动启停顿挫大[x]<br/>
转速愿意上去，发动机声音好听，更类似at搭配的效果<br/>
破损路容易颠，[x]<br/>
悬架贴服性不错<br/>
过弯车身侧倾很好，方向指向性好，视野很好<br/>
2.4L动力很够用<br/>
路噪声音大，隆隆声，本田特色[x]<br/>
和大巴平行时显示车窗隔离效果不错，车厢隔音效果不错，玻璃挺厚，车厢隔音下过功夫<br/>
没自动大灯、自动雨刷、导航，天窗也不是全景的，总之装备确实不好[x]<br/>
后座翻折方便<br/>
顶配是米其林的胎，不过我的是普利司通DUELER H/T 225/65R17</p>

<p>近期本田最好的车，好过雅阁和杰德。功能性、动力操控、机械底子确实好</p>

<p>另外，关于<strong>机油</strong>的选用，以绿罐0w-20的机油为佳。SN，GF-5 级别，建议全合成，周期长一些。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/20/shi-jia-crv/">试驾CR-V</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-20T14:29:00+08:00" pubdate data-updated="true">Jun 20<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>大约1个月前，去邯郸路上的东本4s店看了CR-V，无奈当时的4s还没试驾车，于是只能静态考察。
今天再去4s，终于有了新的试驾车，可以试驾了。</p>

<p>既然再去试驾了，意味着静态考察的结果是令人满意的。这车本身的空间是最让人满意的，后备箱十分平整，
尾门开关的感觉很爽。车子内部的空间也不小，前后排的距离都很宽裕，座椅高低也很适合中国人，无论男女。
对大块头来讲，上上下下进进出出车门也比轿车方便。后排的地台也很平整，中间几乎没有突起，后排也有空调出风口。
这些都是CR-V有优势的地方。</p>

<p>静态不满的地方，还是这个中控和内饰显得确实太廉价了。低廉的气息扑面而来。虽然用了些软性材质，但塑料感依然很强。
2.0的内饰是比较差的。对比同样是日系的天籁，皮革、中控的高级感都是明显不如的。</p>

<p>今天试驾的是2.4顶配，加速很轻巧，本田的CVT看来挺强悍。方向盘也是轻的，不过比rav4重一点。
A柱和rav4也差不多，有点档视线。当初2.0的内饰让人感觉比较粗陋，
到了2.4全皮的座椅，坐在里面依然掩饰不了铺面而来的廉价感，车厢感觉真的比天籁这类车差很多。
虽然是皮质的座椅和搁手的，但这个皮质手感不佳。
不过想要的是suv，也只能这样了。
后视镜的视野很好，看的很清楚。加速方面和凯越不比了，比天籁也还是快，看来直喷真有直喷的好处。开起来后方向盘会加重，
原地挪车的话方向盘可是足够轻的，适合单手揉轮。</p>

<p>总的来讲，此次试驾的结果让我相当满意，原本打算立刻下单的，不过因为家长的原因还要再等几天。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/19/nscd/">Nscd</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-19T13:56:00+08:00" pubdate data-updated="true">Jun 19<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>NSCD是name service cache daemon的缩写，主要用于在linux下对dns查询的结果进行缓存。
默认情况下，linux是不对dns进行缓存的，因此可能会对应用的性能产生影响。只有开启了nscd服务，才会拥有缓存。</p>

<p>服务的安装很简单，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum install nscd
</span><span class='line'>service nscd start
</span></code></pre></td></tr></table></div></figure>


<p>这样就可以开启nscd的服务了。
如果本身就面临性能问题，可以直接测试一下看看性能有没有提高。除此之外可以通过下列命令检查一下效果：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>nscd -g | grep <span class="s1">&#39;hosts cache&#39;</span> -A 22
</span></code></pre></td></tr></table></div></figure>


<p>可以得到如下的信息：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>hosts cache:
</span><span class='line'>
</span><span class='line'>            yes  cache is enabled
</span><span class='line'>            yes  cache is persistent
</span><span class='line'>             no  cache is shared
</span><span class='line'>            211  suggested size
</span><span class='line'>         216064  total data pool size
</span><span class='line'>            336  used data pool size
</span><span class='line'>           3600  seconds <span class="nb">time </span>to live <span class="k">for </span>positive entries
</span><span class='line'>             20  seconds <span class="nb">time </span>to live <span class="k">for </span>negative entries
</span><span class='line'>            139  cache hits on positive entries
</span><span class='line'>              4  cache hits on negative entries
</span><span class='line'>              8  cache misses on positive entries
</span><span class='line'>              6  cache misses on negative entries
</span><span class='line'>             91% cache hit rate
</span><span class='line'>              2  current number of cached values
</span><span class='line'>              4  maximum number of cached values
</span><span class='line'>              1  maximum chain length searched
</span><span class='line'>              0  number of delays on rdlock
</span><span class='line'>              0  number of delays on wrlock
</span><span class='line'>              0  memory allocations failed
</span><span class='line'>            yes  check /etc/hosts <span class="k">for </span>changes
</span></code></pre></td></tr></table></div></figure>


<p>其中有命中率，cache命中的次数等信息。positive是指查询成功，negative是指查询失败。</p>

<p>但是，很多情况下，可能开启nscd之后，会发现命中率一直为0。原因在于很多linux服务会采用直接访问的模式来读取缓存，
直读的模式性能更好，但因为不经过daemon，所以无法进行统计。解决办法是把<code>shared</code>的属性关闭。</p>

<p>修改<code>/etc/nscd.conf</code>，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>   <span class="nb">enable</span>-cache            hosts           yes
</span><span class='line'>    positive-time-to-live   hosts           3600
</span><span class='line'>    negative-time-to-live   hosts           20
</span><span class='line'>    suggested-size          hosts           211
</span><span class='line'>    check-files             hosts           yes
</span><span class='line'>    persistent              hosts           yes
</span><span class='line'>    shared                  hosts           no
</span><span class='line'>    max-db-size             hosts           3355443
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/16/yun-ti-yue-lai-yue-lan-liao/">云梯越来越烂了</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-16T21:46:00+08:00" pubdate data-updated="true">Jun 16<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>唉，云梯是越来越不给力了。之前的新加坡1站点还能用用，最近这个月来基本是没法用了。
绝对令人失望。</p>

<p>Update on 2015.07.22: 据说是因为517电信网通大提速后国内开展了大量50M 100M的带宽，导致骨干网资源严重不足造成的。
客服mm回答根据以往的经验一般电信等运营商在2周左右会调整好。而后续的发展也证明了此种说法，只是时间稍微又长了一两个礼拜。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/01/spring-in-action-4/">Spring in Action 4</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-01T10:31:00+08:00" pubdate data-updated="true">Jun 1<span>st</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>大约两年前，又读了In action的第三版，感觉离实际的开发已经有点远了，里面讲的内容反应不了当时Spring主要的用法。于是换了
《Spring In Practice》学习，比当时的in action贴近实际反应现状多了。<br/>
好在，In action在14年年末又出了新的版本。
经典的Spring系列又出了第4版，这一版是完全跟上了Spring发展的脚步，呈现的也是最新的Spring开发内容，而且聚焦于Spring Web。</p>

<p>内容比较新颖，作者的文章也总喜欢和读者拉拉家常，所以整个书读起来也比较有意思。不过，这本书不适合完全没Java Web开发基础的读者，
其整个书还是写给已经使用Spring进行开发或者至少已经略懂什么是Java Web开发的人，所以，学这本书前必须要有一点基础。</p>

<h2>Spring的基础介绍</h2>

<p>这部分也是整个系列一直的拿手好戏，现在总结的是越来越精彩，在Xml配置和Java Config中也完全倒向后者了，不过更多的也是通过这两个配置结合了自动扫描的配置方法，即Annotation。</p>

<h3>Spring 的四大法宝：</h3>

<ol>
<li>PoJo</li>
<li>DI（依赖注入，取代各个类之间的内部new）</li>
<li>Aspect（Feature），给每个method加上chain，主要用于Transaction、logging、security、cacching这些领域</li>
<li>Template（JDBCTemplate等等)，即模板方法，用于减少冗长代码的写入。</li>
</ol>


<p>而这一切的基础是Java的动态编程，除了Java自带的反射，其实大量使用了CGLib库。</p>

<h3>Profile</h3>

<p>通过<code>@Profile("dev")</code>来表明在什么情况下使用下面的标注或配置，即激活哪一种配置属性。有两个变量可以指定值</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>spring.profiles.active
</span><span class='line'>spring.profiles.default</span></code></pre></td></tr></table></div></figure>


<p>其中，<code>default</code>可以在web.xml中定义，而<code>active</code>可以在系统属性、环境变量、JNDI或者@ActiveProfiles中定义，因为<code>active</code>的优先级更高。</p>

<h3>其他一些标注</h3>

<p>@Primary 用于消除bean的歧义性（比如有多个同名或同类型、同接口），在声明是可以使用表明这个为主。<br/>
@Qualifier，用于一步一步的Narrow指定匹配，不过似乎耦合了点，个人觉得不推荐使用<br/>
@Scope，这个很关键，指定了生成bean使用的容器, Prototype是每次new一个，大部分默认是单例，还有基于Session和Scope的bean注入，解决了web开发时的有些信息注入的难题。具体可参看<a href="/blog/2015/05/19/httpsessionzai-springzhong-de-pei-fa-he-wen-ti/">HttpSession在Spring中的配法和问题</a>。</p>

<h2>Aop</h2>

<p>Aop 提供了在method的前后增加功能（Feature）的能力，而这些功能往往是针对业务某些统一的能力的，所以称之为切面，意在把日志、事物、安全等功能提取出来，并且Spring配套了一系列术语称呼AOP中的各个角色。
但本质上还是一种定义Hook的模式。</p>

<ul>
<li>Advice ， 功能本身</li>
<li>PointCut，实际需要使用的Join Points</li>
<li>Joinpoints，在哪些点（方法中插入）</li>
</ul>


<p>插入的时机有：
1. Before: method调用前
2. After all: method调用后
3. After returning success: method调用成功
4. After throwing: method调用出现例外
5. Around: 写法最复杂，需要把调用的chain写在Advice里面</p>

<p>具体用分为:<br/>
1. Introductions: 给现有的class <strong>加</strong>(新增)方法或属性, 类似加入一个模块
2. weaving（编织、插入）：代理插入，可以在编译时、加载class时以及运行时混入</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/19/httpsessionzai-springzhong-de-pei-fa-he-wen-ti/">HttpSession在Spring中的配法和问题</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-19T17:22:00+08:00" pubdate data-updated="true">May 19<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最早出于使用struts2的习惯，在Spring中如果需要使用<code>HttpSession</code>，做法是把这个对象作为整个类的一个实例对象。</p>

<p>1</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Log</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="n">TestController</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Autowired</span>
</span><span class='line'>  <span class="n">HttpSession</span> <span class="n">session</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>后来因为担心Controller在Spring中是单例的（在struts2中是多例的），怕引出线程安全问题，于是把<code>session</code>放入了method中进行注入。</p>

<p>2</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@ResponseBody</span>
</span><span class='line'>  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span>  <span class="n">produces</span> <span class="o">=</span> <span class="n">MediaTypes</span><span class="o">.</span><span class="na">TEXT_HTML_UTF_8</span><span class="o">)</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">testSession</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">hashCode</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>  <span class="o">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;val&quot;</span><span class="o">)!=</span><span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;val&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">i</span><span class="o">++;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;val&quot;</span><span class="o">,</span> <span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;hashCode: &quot;</span> <span class="o">+</span> <span class="n">hashCode</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">hashCode</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>近日在学习Spring in Action的过程中，发现其实第一种方式下使用了<code>proxy 模式</code>, 实际被注入的类是<code>session  $Proxy38</code>这样的代理类，
类似于避免反复调用<code>createEntityManager</code>的做法，该代理类会寻找实际对应的session并进行操作,只是给controller注入了一个壳。</p>

<p>而第2种方法中，注入的则是标准的容器session: <code>org.apache.catalina.session.StandardSessionFacade</code></p>

<p>3</p>

<p>此外，受到推崇的是第三种写法，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Component</span>
</span><span class='line'><span class="nd">@Scope</span><span class="o">(</span><span class="n">proxyMode</span><span class="o">=</span><span class="n">ScopedProxyMode</span><span class="o">.</span><span class="na">TARGET_CLASS</span><span class="o">,</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;session&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShoppingCart</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这种写法将整个购物车变成一个scope属于session的bean，由spring注入并负责保存。</p>

<p>但这种写法我个人感觉有点过于抛离了web开发。尽管Spring的一大好处是取消对容器的依赖，从而做到测试的方便。但完全和Web容器隔离，变得不像Web开发也不是什么好的策略。
毕竟Session的概念几乎每个Web开发者都有，而scope=session则反而会增加沟通的难度。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/17/lao-luo-he-chi-jian-qiang/">老罗和池建强，现代创业和打工</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-17T00:15:00+08:00" pubdate data-updated="true">May 17<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>老罗和他的锤子手机是一直存有很大的争议，在去年<a href="/blog/2014/08/30/lao-luo-he-wang-zi-ru/">老罗pk刘翔</a>就显露无疑。</p>

<p>回过头来看9个月过去了，当初的判断有些是应验了：</p>

<ol>
<li>锤子手机的价格客户基本不买账，于是3000元的售价<strong>跌了500-1000</strong>。</li>
<li>老罗赢了王自如，但不代表能<strong>赢得市场</strong>，锤子手机依然需要大规模输血。</li>
<li><strong>老罗是个人物</strong>，继续招兵买马，虽然有点病急乱投医的意思，但意志确实坚定。</li>
<li>刘翔是只能唯雷军是从了，因为雷军已经<strong>是他的老板而不只是客户</strong>。</li>
</ol>


<p>上周稍微新鲜点的就是老罗把池建强老师招入麾下了。池老师是一个传统企业软件公司的技术负责人，
文章和mac方面的技术在程序员圈中还是相当有名的。文笔确实不错，难能可贵的是坚持笔耕不辍，长期能保持
较高的水准，这对一个非媒体的编辑而言还是很不容易的。
老罗给池建强的职务是：<strong>锤子科技云平台研发总监</strong>。
即锤子从传统软件企业那里挖了个人去负责电商和锤子云，这没啥好多说的，槽点是据说给的年薪是4赵多人民币。
让我感觉老罗太能烧钱了。后来了解到是在4月下旬的时候，郑刚在天使轮给罗永浩投了4000万， B轮又追加投资，
累计重仓已经超过一亿元人民币。也难怪锤子又有燃料可以继续前进。很可能就是因为投资确定拿到了，
然后这个雇人的举动也就公布了。如果之前4kw（其实应该还有其他投资）就做出了产品上市，那这6kw至少可以坚持不少时间的，
毕竟主要就是付工资而不是开模具了。</p>

<p>老罗会不会因为此事成功？在我看来，老罗成功的可能性始终很小，能烧钱当然就能继续。而招入池老师很可能跟
锤子能不能混出来的相关性也有限，即成功了可能跟这次举动关系不大、失败了可能就更没关系。毕竟能否成功取决于
太多的因素。</p>

<p>回想起Fenng写的如今创业的描述，确实现在创业好像是也有点像打工了：是有人出钱的，只是创业者的自主权很大，
回报比普通打工更多，虽然成功几率依然很小，但创业的风险和难度都实打实地降低了。
烧别人的钱做事情的后果是好是坏很难讲，有好有坏只是一种笼统的说法，我目前也分析不出来到底是好处多还是坏处多。
但是，这肯定代表着一种活力，这也是过去十几年IT行业能快速发展的基础动力之一。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/7/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/10/05/nipon-software-team/">日式高效团队开发</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/10/04/rancher-and-k8s/">rancher and k8s</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/08/learning-agile/">Learning Agile： 理解Scrum, XP, Lean and Kanban</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/03/jian-chi-de-cheng-guo/">坚持的成果</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/01/crv-2018/">2018 CRV养车成本汇总</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/技术'>技术 (81)</a></li><li><a href='/blog/categories/生活'>生活 (49)</a></li><li><a href='/blog/categories/车车'>车车 (36)</a></li><li><a href='/blog/categories/java'>Java (30)</a></li><li><a href='/blog/categories/时评'>时评 (23)</a></li><li><a href='/blog/categories/读书笔记'>读书笔记 (23)</a></li><li><a href='/blog/categories/神器'>神器 (23)</a></li><li><a href='/blog/categories/笔记'>笔记 (19)</a></li><li><a href='/blog/categories/ruby'>Ruby (18)</a></li><li><a href='/blog/categories/spring'>Spring (15)</a></li><li><a href='/blog/categories/rails'>Rails (13)</a></li><li><a href='/blog/categories/项目管理'>项目管理 (11)</a></li><li><a href='/blog/categories/linux'>Linux (11)</a></li><li><a href='/blog/categories/软考'>软考 (8)</a></li><li><a href='/blog/categories/crv'>Crv (6)</a></li><li><a href='/blog/categories/nodejs'>Nodejs (6)</a></li><li><a href='/blog/categories/云计算'>云计算 (6)</a></li><li><a href='/blog/categories/nosql数据库'>Nosql数据库 (5)</a></li><li><a href='/blog/categories/heroku'>Heroku (4)</a></li><li><a href='/blog/categories/旅游'>旅游 (4)</a></li><li><a href='/blog/categories/管理'>管理 (4)</a></li><li><a href='/blog/categories/script'>Script (3)</a></li><li><a href='/blog/categories/装机'>装机 (3)</a></li><li><a href='/blog/categories/读书列表'>读书列表 (3)</a></li><li><a href='/blog/categories/mac'>Mac (2)</a></li><li><a href='/blog/categories/期刊'>期刊 (2)</a></li><li><a href='/blog/categories/git'>Git (2)</a></li><li><a href='/blog/categories/外刊'>外刊 (2)</a></li><li><a href='/blog/categories/安卓'>安卓 (1)</a></li><li><a href='/blog/categories/键盘'>键盘 (1)</a></li><li><a href='/blog/categories/区块链'>区块链 (1)</a></li><li><a href='/blog/categories/测试'>测试 (1)</a></li></ul>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Hegel 2011 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <a title="Web Statistics" href="http://getclicky.com/66623321"><img alt="Web Statistics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
  <script src="//static.getclicky.com/js" type="text/javascript"></script>
  <script type="text/javascript">try{ clicky.init(66623321); }catch(e){}</script>
  <noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66623321ns.gif" /></p></noscript>

</p>

</footer>
  







<script type="text/javascript">
    (function() {
        var twitterWidgets = document.createElement('script');
        twitterWidgets.type = 'text/javascript';
        twitterWidgets.async = true;
        twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
        document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
</script>




</body>
</html>
