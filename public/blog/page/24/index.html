
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hegel2011的博客</title>
  <meta name="author" content="Hegel 2011">

  
  <meta name="description" content="heredocs是什么 heredocs适用于在代码中写一长串文档赋给变量的情形。标准的ruby heredocs是这样的 1
2
3
4
5
text = &lt;&lt;END
aaa
bbb
ccc
END 但是使用heredocs的时候常有时灵时不灵的情形，这个陷阱在于最后一行的缩进。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://octopresszhangyu.herokuapp.com/blog/page/24/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Hegel2011的博客" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Hegel2011的博客</a></h1>
  
    <h2>读书 - 工作 - 生活 - 笔记</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:octopresszhangyu.herokuapp.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">关于自己</a></li>
  <li><a href="/blog/2015/02/20/to-read-list/">To-Read</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/19/heredocs/">Heredocs 和缩进</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-19T12:41:00+08:00" pubdate data-updated="true">Apr 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>heredocs是什么</h3>

<p><strong>heredocs</strong>适用于在代码中写一长串文档赋给变量的情形。标准的ruby heredocs是这样的</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">text</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">END</span>
</span><span class='line'><span class="sh">aaa</span>
</span><span class='line'><span class="sh">bbb</span>
</span><span class='line'><span class="sh">ccc</span>
</span><span class='line'><span class="no">END</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是使用heredocs的时候常有<strong>时灵时不灵</strong>的情形，这个陷阱在于最后一行的缩进。默认情况下，END是必须顶格的，比如可以这样写</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Poem</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="vi">@text</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">END</span>
</span><span class='line'><span class="sh">&quot;Faith&quot; is a fine invention</span>
</span><span class='line'><span class="sh">When Gentlemen can see</span>
</span><span class='line'><span class="sh">But Microscopes are prudent</span>
</span><span class='line'><span class="sh">           In an Emergency.</span>
</span><span class='line'><span class="sh">(Emily Dickinson 1830-1886)</span>
</span><span class='line'><span class="no">END</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">recite</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="vi">@text</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是这样写就是<strong>不行</strong>了：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">text</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">END</span>
</span><span class='line'><span class="err">  aaa</span>
</span><span class='line'><span class="err">  bbb</span>
</span><span class='line'><span class="err">  END #END加了缩进就失败</span>
</span><span class='line'>  <span class="n">aaa</span>
</span><span class='line'>  <span class="n">bbb</span>
</span><span class='line'>  <span class="k">END</span> <span class="c1">#END加了缩进就失败</span>
</span></code></pre></td></tr></table></div></figure>


<h3>解决办法</h3>

<p>在第一个END前面加<code>-</code>，即使用<code>-END</code>，会让最后结束符<code> END</code>前的空白都被忽略，而<strong>内容前面的空白则会被保留</strong>。如果也要去掉，可以使用gsub.
此处END可以换成任意大写字符，只要成对匹配即可。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Poem</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="vi">@text</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">END</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^ {6}/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="sh">      &quot;Faith&quot; is a fine invention</span>
</span><span class='line'><span class="sh">      When Gentlemen can see</span>
</span><span class='line'><span class="sh">      But Microscopes are prudent</span>
</span><span class='line'><span class="sh">                 In an Emergency.</span>
</span><span class='line'><span class="sh">      (Emily Dickinson 1830-1886)</span>
</span><span class='line'><span class="no">    END</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">recite</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="vi">@text</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3><code>%w</code>是何方神圣</h3>

<p>有几次，我直接使用<code>%w{}</code>以为解决了这个问题。但实际上得到是一个Array。只不过Array.to_s又会获得和heredocs一样的效果，在使用ruby1.9的前提下。
%w要灵活方便的多吧，但这个确实不是heredocs，它只是数组。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">text2</span> <span class="o">=</span> <span class="sx">%w{</span>
</span><span class='line'><span class="sx">aaa</span>
</span><span class='line'><span class="sx">bbb</span>
</span><span class='line'><span class="sx">ccc</span>
</span><span class='line'><span class="sx">  dddd</span>
</span><span class='line'><span class="sx">      }</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="n">text2</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://www.bitcetera.com/en/techblog/2009/07/02/heredoc-with-indent-in-ruby/">引用链接1</a></li>
<li><a href="https://github.com/styleguide/ruby">引用链接2</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/19/some-useful-link/">Ruby Inside 3月链接</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-19T11:23:00+08:00" pubdate data-updated="true">Apr 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>发现<a href="http://www.rubyinside.com/march-2012-ruby-news-5841.html?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+RubyInside+%28Ruby+Inside%29">Ruby Inside</a>最近的
文章又好看了起来。选了一些细细研究如下。</p>

<ul>
<li><p><a href="https://github.com/styleguide/ruby">GitHub&#8217;s Ruby Style Guide</a><br/>
很好的ruby编码规范，来自github，还澄清了我一些似是而非的概念。值得ruby学习者经常review。<br/>
此外，还有<a href="http://tomdoc.org/">tomdoc</a>做编码文档的规范，也需要进一步阅读。</p></li>
<li><p><a href="http://rubysource.com/zero-to-jekyll-in-20-minutes/">jekyll</a></p></li>
</ul>


<p>jekyll是一个输入markdown文件输出site的html的<strong>引擎</strong>。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mkdir your_blog
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ./your_blog
</span><span class='line'><span class="nv">$ </span>mkdir _layouts _plugins _includes _posts css javascripts images
</span><span class='line'><span class="nv">$ </span>touch index.html _config.yml _layouts/default.html
</span></code></pre></td></tr></table></div></figure>


<p>目录树结构</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>├── README.md
</span><span class='line'>├── _config.yml
</span><span class='line'>├── _layouts
</span><span class='line'>  └── default.html
</span><span class='line'>├── _plugins
</span><span class='line'>├── _includes
</span><span class='line'>├── _posts
</span><span class='line'>│   ├── 2012-03-27-your_first_post_in_markdown.md
</span><span class='line'>│   └── 2012-03-27-your_second_post_in_textile.textile
</span><span class='line'>├── css
</span><span class='line'>│   └── screen.css
</span><span class='line'>├── javascripts
</span><span class='line'>├── images
</span><span class='line'>└── index.html
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>jekyll --server --auto
</span></code></pre></td></tr></table></div></figure>


<p>文档的要求只有一个:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>---
</span><span class='line'>layout: default
</span><span class='line'>title: Your First Post In Markdown
</span><span class='line'>---
</span></code></pre></td></tr></table></div></figure>


<p>就会按markdown里面的layout产生内容。</p>

<p>这样就可以明白octopress和jekyll的关系了。o是利用了jekyll做引擎，根据jekyll的目录要求加入了css、布局、图片等，同时还有.rb的一些插件，于是有了这个blog系统。而jekyll则还可以用来写书。道理也是一样的。自己设计layout，然后运行上面的命令即可。</p>

<ul>
<li><a href="http://spin.atomicobject.com/2012/02/28/load-balancing-and-reverse-proxying-with-nginx/">使用Nginx做分发的教程</a></li>
</ul>


<p>基本的内容都有了。而且还有利用nginx实现转发时使用basic验证和加Authorization的例子。</p>

<ul>
<li><a href="http://news.railstutorial.org/ruby-on-rails-tutorial-now-with-twitters-boot">配备了bootstrap的Rails教程</a></li>
</ul>


<p>Bootstrap 是一个优秀的CSS和UI框架，而这个正好是Rails所欠缺的。二者的结合将是威力巨大的。因为Rails可以解决开发中的
<strong>编码效率</strong>问题，但对<strong>界面美化</strong>却不能为力。而Bootstrap可以很好地弥补这一点。有点类似Jekyll和Octopress的关系。
<strong>结果</strong>都是可以让程序员和不具备界面美化能力的项目经理也可以设计出说得过去的应用。</p>

<ul>
<li><p><a href="http://patshaughnessy.net/2012/3/23/why-you-should-be-excited-about-garbage-collection-in-ruby-2-0">ruby 2.0 garbage collection</a></p></li>
<li><p><a href="http://addyosmani.com/blog/building-backbone-js-apps-with-ruby-sinatra-mongodb-and-haml/">building backbone js apps with ruby sinatra mongodb and haml</a></p></li>
</ul>


<p>全篇对backbone基本无介绍，火力集中在sinatra mongodb haml这些东西上了。文章的价值不大。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/19/taps-a-simple-app-to-transfer-data/">Taps： 一个导数据的工具</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-19T10:21:00+08:00" pubdate data-updated="true">Apr 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在railscast上看到了一个介绍导入导出数据的工具<a href="https://github.com/ricardochimal/taps">taps</a>.</p>

<p>最大的亮点在于:</p>

<ol>
<li>是用起服务的方式来完成。先针对一个数据库启动一个server监听在5000端口，随后在它处启动一个脚本导数据；</li>
<li>可以跨数据库导入导出。实际上中间是用到了<a href="sequel.rubyforge.org/">sequel</a>这个ruby的Orm框架，所以理论上应该是只要有adapter的数据库就都能被匹配。</li>
</ol>


<p>使用也非常之简单与直接</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gem install taps
</span><span class='line'><span class="nv">$ </span>taps server postgres://localdbuser:localdbpass@localhost/dbname httpuser httppassword
</span><span class='line'><span class="nv">$ </span>taps pull postgres://dbuser:dbpassword@localhost/dbname http://httpuser:httppassword@example.com:5000
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/17/gimli-and-markdown-2-pdf/">Gimli and Markdown 2 Pdf</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-17T15:24:00+08:00" pubdate data-updated="true">Apr 17<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>想把博客部分文章转换成pdf，利于直接把文件分发。试了很多东西，包括 pandoc、little book 等等。
最终在这个法国人的<a href="http://kevin.deldycke.com/2012/01/how-to-generate-pdf-markdown/">博客</a>中找到了很好的解决办法。
最后因为安装了gimli，最终直接解决了格式、中文编码等各种问题。</p>

<p>先安装 Pandoc</p>

<p><code>sudo agt-get install pandoc nbibtex texlive-latex-base texlive-latex-recommended texlive-latex-extra preview-latex-style dvipng texlive-fonts-recommended</code></p>

<p>安装ruby的gem gimli</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo agt-get install wkhtmltopdf
</span><span class='line'>gem install gimli
</span></code></pre></td></tr></table></div></figure>


<p>最后运行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gimli -f ./README.md
</span></code></pre></td></tr></table></div></figure>


<p>即可得到类似GitHub风格的pdf文档。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/17/deployment-and-administration-for-mongod/">Learning Mongodb (3) 部署和管理</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-17T11:07:00+08:00" pubdate data-updated="true">Apr 17<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>系列链接：</p>

<ol>
<li><a href="/blog/2012/03/29/learning-mongodb-1/">mongodb基础</a></li>
<li><a href="/blog/2012/03/30/learning-mongodb-2/">尝试分布式及复制  （sharding and replication)</a></li>
<li><a href="/blog/2012/04/17/deployment-and-administration-for-mongod/">部署和管理</a></li>
</ol>


<h3>部署环境要求</h3>

<ul>
<li><p>架构</p>

<ul>
<li><strong>64-bit</strong> , mongo会把所有的文件都map成虚拟地址空间，32位至多只能利用2GB内存空间</li>
<li>little-endian , 不适合SPARC, PowerPC, PA-RISC，客户端（驱动）无所谓运行环境</li>
</ul>
</li>
<li><p>CPU</p>

<ul>
<li>非cpu密集型应用</li>
<li>I/O瓶颈远比CPU瓶颈出现的可能性多</li>
<li>多客户端同时读时，多核会被利用</li>
<li>写操作还是单核</li>
</ul>
</li>
<li><p>RAM</p>

<ul>
<li>越多越好</li>
<li>working set， index size， ram总数</li>
</ul>
</li>
<li><p>Disk</p>

<ul>
<li>IOPS 优先</li>
<li><em>background flush</em> 60s sync到磁盘一次</li>
<li>ssd可以优化速度（solid state drive）</li>
<li>RAID 10 组成 LVM</li>
</ul>
</li>
<li><p>文件系统</p>

<ul>
<li>ext4 或者 xfs，快速、连续的磁盘分配</li>
<li>禁用access time(atime)更新</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># 禁用 atime更新</span>
</span><span class='line'>sudo mv /etc/fstab /etc/fstab.bak
</span><span class='line'>sudo vim /etc/fstab
</span><span class='line'><span class="c"># file-system mount type options dump pass</span>
</span><span class='line'><span class="nv">UUID</span><span class="o">=</span>8309beda-bf62-43 /ssd ext4 noatime 0 2
</span><span class='line'>
</span><span class='line'>改完文件后，可以不用重启
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>文件描述符(FD)

<ul>
<li>默认的1024不够用  <code>lsof | grep mongo | wc -l</code> 可以查看当前mongod打开了多少个文件和连接</li>
<li>调大 <code>ulimit -Hn</code> 可以查看</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>vi /etc/security/limits.conf
</span><span class='line'>mongodb hard nofile 10240
</span><span class='line'>下次登录后生效
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>时钟</p>

<ul>
<li>ntp协议，在跑shard和replication时候必须启用的东西</li>
</ul>
</li>
<li><p>ec2上使用mongodb</p>

<ul>
<li>ec2易用、地理范围广、价格有竞争力</li>
<li>68GB RAM的限制</li>
<li>使用  EBS 存储， 吞吐性能一般化</li>
</ul>
</li>
</ul>


<h3>服务器配置</h3>

<ul>
<li><p>选择拓扑</p>

<ul>
<li>是否需要shard， 是否需要replica</li>
<li>建议多机</li>
</ul>
</li>
<li><p>打开journal标志</p></li>
</ul>


<h3>安全保障</h3>

<ul>
<li><p>环境安全</p>

<ul>
<li>防火墙</li>
<li>数据的传输是不加密的</li>
</ul>
</li>
<li><p>授权</p>

<ul>
<li>给admin区增加用户<code>use admin; db.addUser("boss", "supersecret")</code></li>
<li>启动时带上选项 <code>mongod --auth</code></li>
<li>使用admin然后再授权 <code>use admin; db.auth("boss", "supersecret")</code></li>
<li>给其他库，如stock，创建用户 <code>use stocks; db.addUser("trader", "moneyfornuthin")</code></li>
<li>查找用户 <code>db.system.users.find()</code></li>
</ul>
</li>
<li><p>keyFile</p>

<ul>
<li>cluster 和 sharding 的时候需要制定keyFile，mongos实例也要具备这个密钥文件</li>
</ul>
</li>
<li><p>日志记录</p>

<ul>
<li>运行时&#8211;logpath指定</li>
</ul>
</li>
</ul>


<h3>监控工具</h3>

<ul>
<li><p>serverStatus<br/>
<code>use admin; db.runCommand({serverStatus: 1})</code><br/>
<strong>globalLock</strong> 表示等待写锁的时间。ratio过高意味着需要优化调整<br/>
<strong>mem</strong> 段的单位是MB</p></li>
<li><p>mongostat</p>

<ul>
<li>类似 iostat 运行的效果</li>
</ul>
</li>
<li><p>web console</p>

<ul>
<li>&#8211;rest 标志打开的话，可以从web处得到更多的运行信息</li>
</ul>
</li>
</ul>


<h3>备份与压缩</h3>

<p>mongodump 和 mongorestroe两个组合，也可以直接拷贝文件。不过后者要求lock数据库，即要求mongod停止往磁盘同步。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/15/lessons-from-a-training-on-pm/">PM培训课程小结</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-15T13:42:00+08:00" pubdate data-updated="true">Apr 15<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>趁着这个集成项目经理培训的五天培训，把辅导材料基本过了一遍。结合一些自己的经验，以及看<a href="http://xdite-smalltalk.tumblr.com/post/18034694291">别人</a>的一些文章，谈谈
自己的想法。</p>

<p>整本培训洋洋洒洒地讲了很多东西，客观的说能全面解析出这样一套体系的人相当的不简单。但是，这套体系应该说还是基于瀑布模型的，只不过
把大瀑布分拆成了n个小瀑布。实际上对软件开发并不太适用。不过因为整套体系认为<strong>光有集成</strong>是没有自己的竞争力的，要求有<strong>30%</strong>的软件开发内容，
于是又把软件开发放在里面。这也让我终于明白了工作的第一个部门成立的<strong>指导思想来源</strong>。因为我曾经相当一段时间纳闷为什么非要把系统集成
和研发凑合成一个部门。而且整个软件组还受集成一侧领导。这样能做出什么好东西来。但现在终于了解了这样组织的来源，而且以集成为主导也是因为这里面
要求软件比例不低于30%。</p>

<p>读了这本材料，终于明白公司是抄自国家认证考试的体系。也可能是其他人这么建议的，而也受了这个认证体系理论的影响。</p>

<p>软件开发有其自身的特点和重点。集成体系用其无所不包、范围够广的方式（9大范围）强行把软件包裹了进去。尽管看上去纳入了，但重点很不突出。
毕竟即使有软件工程也和系统工程是两码事情。所以，这次培训最大的结果是了解集成到底是什么思路，然后就通过这个考试，剩下的也只有自己继续摸索。</p>

<p>先说说集成这套体系。</p>

<p>首先，体系强调章程和计划。章程只有一个，而计划各个领域可以有很多。实际上，<strong>计划也是章程</strong>。只不过灵活度比章程强，可以按照需要进行
变更、更新，而章程定下了就不怎么更新了。计划或者章程规定了要做哪些事情，什么时候做，相关人员是什么，什么情况下需要变更。
随后就是一堆输入输出的交付物。</p>

<p>接下去的东西就好理解了，反正整个东西追求的结果都是文档。当然，文档确实有很多种，有些方法对保证系统也确实有帮助。
比如需求管理中的use case，每个case其实还是要用文字说明的，case图可以让需求方和系统分析师把东西交流清楚。但本质上就是
一个list，只是说明参与对象是什么。WBS分解，可以用于进一步细化和确认需求，分写出要做的工作。这些都是和软件开发业密切相关的，
但是在此之外，其他的东西实质上和软件的关联就不怎么大了。</p>

<p>最后，就是强调一切东西都要有确认，变更等都要走流程。这些东西如果乙方有能力实施，当然是很好的。</p>

<p>此外，还有一些东西就是骗来骗去的了。比如进度估计、成本估计，实际上即使传统的工程，能准确估算出来的都是很少的。</p>

<p>经典的启动、计划、执行、监控和收尾，又叫做PDCA（Plan Doing Check Action), 典型的普遍模型，自上而下。只是又可以分解成n个小瀑布。
但是，这个真的是软件开发里面最重要的事情嘛？</p>

<p>恐怕不是。</p>

<p>就我看来，软件或者互联网应用更多的强调对自身功能和模块的拆分，启动时往往很难明确细化东西。即使建筑工程本身，也就是这套体系产生的原型，
也有众多管理失败的案例，巴拿马运河等，那么软件对这套系统的适应性恐怕更难。而且这套体系显然没考虑很多项目管理工具的使用，如redmine、如版本控制系统，
而不同的工具或进步的工具是可以颠覆整个开发行为的。条条框框和优秀的软件结合起来会完全改变制造方式。与此相比，管理体系本身就显得僵化。当然，值得吸取的部分还是有的。
比如我们需要一个章程，需要需求的确认。</p>

<p>最最重要的，就是list要做的事情，给出最终时间。WBS后，确认细节，排好顺序，随后和用户确认。</p>

<p>而在这中间，系统的调整能力和团队和用户沟通的软实力才是起决定作用的东西。</p>

<p>Update(2012-05-15): 读了<a href="http://blog.xdite.net/posts/2012/05/13/the-startup-owners-manual-02/?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+xxddite+%28Blog.XDite.net%29">New product Introduction Model的九宗罪</a>
进一步明确了PM这套东西不适合的原因。确实，这套东西适合的是“在有確定用戶，確定市場，確定 bussiness model 的情況下才能使用。也只有在這樣的情況下才有機會成功。”
“這很大程度了解釋了為什麼：個人、大公司要『新創』一個事業很容易失敗。而一些『大公司』要『山寨』一個服務也有機會取得成功。” <br/>
那么反过来，对于不够明确的、大家都还没谱的、都需要摸索的项目就不合适。<br/>
所谓<strong>执行</strong>是针对有成熟套路的东西，考察的是系统的熟练程度和配合程度。而创新、新业务是需要<strong>试错的</strong>，其中的核心能力是<strong>学习</strong>、<strong>摸索</strong>、<strong>观察</strong>和<strong>勇气</strong>。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/12/knowing-what-not-to-test-is-the-harder-part/">思考出哪些不用测试更加重要</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-12T21:06:00+08:00" pubdate data-updated="true">Apr 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>很多次，一直问自己测试代码到底值不值？毕竟我写过几次，但最后发现写测试代码的工作量其实很大。特别是碰到需求变更，本来只要改一处的代码，变得
必须改  <strong>2x</strong> 处。做了一段时间以后，我承认这是对保证质量有效的，但是往往确实不值得，因为得不偿失。另一个问题是先写
测试还是先写程序？</p>

<p>按TDD的要求，无疑测试代码在先，实际代码在后。但根据我写web程序的经验，尤其是那些controller的经验，坚持测试代码在先基本没什么意义。在web上和
数据库上直接看见结果显然更有感觉。</p>

<p>二者结合起来，最后我们就不怎么写测试代码了。尽管对违反TDD有一种罪恶感，但在教条和现实之间，我们还是选择了现实。其实想来比坚持教条要好。但实际上可以处理的更加聪明，也更有效果些。</p>

<p>直到今天读了DHH的 <a href="http://37signals.com/svn/posts/3159-testing-like-the-tsa">测试识别</a> ， 我对上面的问题有了更深一步的认识。</p>

<ol>
<li><strong>严格按照TDD</strong>还是<strong>不写</strong>是两个极端， 实际上中间有很多中间状态。比如，比较优良的测试覆盖率应该在20%，绝不应该超过33% . 道理很简单，就是一直讽刺thoughtworks的他们是在写测试程序而不是真正<strong>有用的软件</strong>。</li>
<li>写测试本来就是不是<strong>免费</strong>的，需要阅读、需要维护、需要动脑筋、需要花时间，而这个时间比例也最好控制起来，20%是不错的一个开销比例。</li>
<li>关键问题在于，也是最难的，是<strong>识别什么东西是需要测试的</strong>，真正值得动脑筋的是这些东西。</li>
<li>识别出要写的测试后，先写测试还是后写其实和在写什么内容关系重大。针对api的可以tdd，而应用类的实际上还是可以先写代码再写测试，毕竟tdd在web中更多的是一种保障作用。</li>
</ol>


<p>得到的教训：</p>

<p>人类最可贵的是 <strong>独立思考</strong> + <strong>灵活运用</strong>， 走极端不好。实际上很多事情都是一个度的问题， 把原则用在需要的地方。 在做其他事情方面也是一样的。
不用追求用了TDD就100%，未满似乎就不是TDD。或者写不到50%以上就索性一点都不写。即使做其他事情的时候，也要牢记这个道理。原则是有价值的，但必须要有灵活的运用。这才是运用技术手段时该抱有的开放的心态。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/08/what-is-numa-and-the-effect-of-it/">What Is Numa and the Effect of It</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-08T22:38:00+08:00" pubdate data-updated="true">Apr 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>研究mongod的时候，知道了一个关于cpu的概念&#8211;numa，但又不知道干嘛的。只知道需要在前面加上numactl来执行:</p>

<p><code>numactl --interleave=all mongod --dbpath /data/db --fork  --logpath /data/db.log</code></p>

<p>而拜读了这篇<a href="http://blog.jcole.us/2010/09/28/mysql-swap-insanity-and-the-numa-architecture/">mysql 和 numa架构关联</a>
的文章，让人豁然开朗。</p>

<p>实际上，numa的本质就是牵涉到如何对内存进行分配，是一个在多cpu、多核中引入的概念。</p>

<p>比如，一个cpu时，那么全部的内存自然只有这个u可用。 但是，2个时呢? 如果一个u里面又有多个核心时，该怎么处理呢？</p>

<p>简而言之，numa的方法是让内存按cpu所属的node进行隔离，好处是提高了内存分配的公平性。但是对于mongod mysqld这样会
吃尽内存的应用，这种确保公平的分配方案并不好。因为根本没有其他核心需要用内存，但需要用内存的核心却会吃不饱。所以需要加上参数，使得这种公平性被取消，从而提高整体效能，其实就是发挥出mongod和mysqld的能力。因为这些应用都是单进程多线程的应用。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/08/about-salesforce/">About Salesforce</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-08T13:41:00+08:00" pubdate data-updated="true">Apr 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Salesforce.com在1999年由前甲骨文高管 Marc Benioff 创立，他创办Salesforce的核心理念就是&#8221;No Software（消灭软件）&#8221;. 指消灭安装在企业内部的软件，
转而使用互联网上的服务。</p>

<p>Salesforce的主要产品包括Sales Cloud（CRM）、Service Cloud、Chatter和Force.com等。下面是它的主要发展史：</p>

<ul>
<li>1999年，Salesforce在美国旧金山成立。</li>
<li>2001年，推出了第一款SaaS应用CRM，同时也受到众多厂商和客户的热议。</li>
<li>2004年，Sunguard成为Salesforce第1000位用户。</li>
<li>2005年，推出了名为&#8221;AppExchange&#8221;的程序商店，以丰富用户选择。</li>
<li>2006年，推出了首个运行在云计算平台的语言Apex，并在语法上类似Java。</li>
<li>2007年，推出了它的PaaS平台Force.com，来让用户更方便地在Saleforce平台上开发在线应用，同时Salesforce凭借Force.com得到了华尔街日报的科技创新奖（Technology Innovation Award）。</li>
<li>2009年，Salesforce成为首家年收入达到10亿美元的云计算公司，并在年初推出了名为&#8221;Service Cloud&#8221;在线客户服务应用。</li>
<li>2010年，Salesforce将推出名为&#8221;Chatter&#8221;的企业级在线SNS服务，类似于企业内部的&#8221;LinkedIn&#8221;，同时其CRM应用已更名为&#8221;Sales Cloud&#8221;。</li>
</ul>


<p>实现了多租户的模型，即每个用户享有一个虚拟出的应用实例，背后的数据库设计是关键。</p>

<p>Salesforce 团队不仅做了优化，
而且凭借着其很多核心成员来自于 Oracle 的背景，在数据库端做了很多高水平的优化，比如添加了很多貌似累赘的 Pivot 表来加快部分常用数据的读取。</p>

<p>salesforce的核心竞争力在于他们的数据库优化。<br/>
他的s云就跑在他们的p云上面，他们的p云叫做force。有一套类似java的语言，允许他人作二次开发后进行部署。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/01/journey-plan-to-hangzhou/">杭州游的计划</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-01T16:26:00+08:00" pubdate data-updated="true">Apr 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>景点：</h3>

<ul>
<li>植物园</li>
<li>划船（自开船）</li>
<li>灵隐寺</li>
<li>岳庙</li>
<li>雷峰塔</li>
<li>胡庆余堂（胡雪岩故居，元宝街18号）</li>
<li>心源茶楼庆春店（非诚勿扰景点）</li>
<li>虎跑</li>
<li>西湖天地</li>
<li>郭庄</li>
</ul>


<h3>美食</h3>

<ul>
<li>武林广场美食</li>
<li>知味观味庄（杨公堤10-12号，花港观鱼西门外）</li>
<li>楼外楼，孤山路30号（岳王庙）</li>
<li>山外山菜馆（植物园北门或者岳王庙）</li>
<li>黄饭儿（靠近胡雪岩故居）</li>
<li>奎元馆</li>
<li>外婆家（近桔子酒店）</li>
</ul>


<h3>串联安排</h3>

<ul>
<li><p>4月5日</p>

<p>早8点出门打的去上海火车站<br/>
11点坐车去<strong>山外山菜馆</strong></p>

<blockquote><p>杭州火车站 终点：杭州植物园北门乘<strong>K7</strong>(火车站东南方向城站火车站上，玉泉下，先网东北走到玉泉路往西北走，到玉古路往北走)。</p></blockquote>

 下午，植物园

<blockquote><p> 植物园北门(玉泉)售票处步行80米 玉泉
15(经过12站|7.2公里|41分钟)还可乘:15K15
打索桥步行40米</p></blockquote>

<p>桔子酒店，旁边的外婆家用晚餐。 酒店出来往南，到文一路往东，到湖墅南路往南，总计300-400米路程。</p></li>
<li><p>4月6日</p>

<p>早9点出门去灵隐寺，知味观味庄用中餐</p>

<blockquote><p>打索桥
23(经过6站|3.9公里|26分钟)还可乘:23K23
黄龙洞黄龙洞
K807(经过6站|4.4公里|27分钟)
灵隐</p>

<p>打索桥
B支1(经过2站|1.7公里|16分钟)还可乘:B支1K11
密渡桥路口密渡桥路口
K807(经过10站|6.9公里|38分钟)
灵隐步行340米</p></blockquote></li>
</ul>


<p> 灵隐 -> 桔子水晶</p>

<blockquote><p>Y1
56分钟
10公里,直达,步行540米,全价1.0元
灵隐寺步行300米
灵隐
Y1(经过13站|9公里|47分钟)
清波门(柳浪闻莺)步行240米</p></blockquote>

<p>  白堤、岳王庙、武松墓</p>

<blockquote><p>坐 Y1</p></blockquote>

<p>  杨公堤、郭庄、太子湾公园<br/>
  雷峰塔、花、钱王祠</p>

<blockquote><p>坐 Y2</p></blockquote>

<p>  桔子水晶，西湖天地</p>

<ul>
<li><p>4月7日</p>

<p>虎跑</p>

<blockquote><p>K822/822/K504/K4/假日9&#8230;
28分钟
5公里,直达,步行220米,全价1.0元
杭州桔子水晶酒店步行120米
清波门
K822(经过5站|4.6公里|27分钟)还可乘:K822822K504K4假日9808
虎跑步行100米</p></blockquote>

虎跑   六和塔

<blockquote><p>K4可通</p></blockquote></li>
</ul>


<p> 水晶  茶楼  西湖周边<br/>
  火车站</p>

<p> 17:00火车返回</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/25/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/23/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2025/04/30/cong-bing-fa-dao-kotlinhe-mo-shi-de-xue-xi/">从并发到Kotlin和模式的学习</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/04/23/wfh-yi-ge-ban-yue/">WFH一个半月</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/12/30/2021-crvyang-che-cheng-ben-hui-zong/">2021 CRV养车成本汇总</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/10/26/the-kubernetes-book/">The Kubernetes Book</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/10/04/java-8-9-10-in-action/">Java 8 9 10 in action</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/技术'>技术 (96)</a></li><li><a href='/blog/categories/生活'>生活 (54)</a></li><li><a href='/blog/categories/车车'>车车 (40)</a></li><li><a href='/blog/categories/java'>Java (36)</a></li><li><a href='/blog/categories/读书笔记'>读书笔记 (26)</a></li><li><a href='/blog/categories/时评'>时评 (24)</a></li><li><a href='/blog/categories/神器'>神器 (23)</a></li><li><a href='/blog/categories/笔记'>笔记 (21)</a></li><li><a href='/blog/categories/ruby'>Ruby (18)</a></li><li><a href='/blog/categories/spring'>Spring (15)</a></li><li><a href='/blog/categories/项目管理'>项目管理 (14)</a></li><li><a href='/blog/categories/rails'>Rails (13)</a></li><li><a href='/blog/categories/linux'>Linux (12)</a></li><li><a href='/blog/categories/软考'>软考 (8)</a></li><li><a href='/blog/categories/云计算'>云计算 (6)</a></li><li><a href='/blog/categories/crv'>Crv (6)</a></li><li><a href='/blog/categories/nodejs'>Nodejs (6)</a></li><li><a href='/blog/categories/nosql数据库'>Nosql数据库 (5)</a></li><li><a href='/blog/categories/旅游'>旅游 (4)</a></li><li><a href='/blog/categories/管理'>管理 (4)</a></li><li><a href='/blog/categories/装机'>装机 (4)</a></li><li><a href='/blog/categories/heroku'>Heroku (4)</a></li><li><a href='/blog/categories/读书列表'>读书列表 (3)</a></li><li><a href='/blog/categories/git'>Git (3)</a></li><li><a href='/blog/categories/script'>Script (3)</a></li><li><a href='/blog/categories/mac'>Mac (2)</a></li><li><a href='/blog/categories/期刊'>期刊 (2)</a></li><li><a href='/blog/categories/外刊'>外刊 (2)</a></li><li><a href='/blog/categories/java'>Java (36)</a></li><li><a href='/blog/categories/键盘'>键盘 (1)</a></li><li><a href='/blog/categories/测试'>测试 (1)</a></li><li><a href='/blog/categories/安卓'>安卓 (1)</a></li><li><a href='/blog/categories/kotlin'>Kotlin (1)</a></li><li><a href='/blog/categories/区块链'>区块链 (1)</a></li><li><a href='/blog/categories/读书'>读书 (1)</a></li></ul>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2025 - Hegel 2011 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <a title="Web Statistics" href="http://getclicky.com/66623321"><img alt="Web Statistics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
  <script src="//static.getclicky.com/js" type="text/javascript"></script>
  <script type="text/javascript">try{ clicky.init(66623321); }catch(e){}</script>
  <noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66623321ns.gif" /></p></noscript>

</p>

</footer>
  







<script type="text/javascript">
    (function() {
        var twitterWidgets = document.createElement('script');
        twitterWidgets.type = 'text/javascript';
        twitterWidgets.async = true;
        twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
        document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
</script>




</body>
</html>
