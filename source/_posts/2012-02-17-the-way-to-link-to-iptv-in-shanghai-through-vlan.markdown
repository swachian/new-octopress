---
layout: post
title: "上海电信IPTV的VLAN ID和通过交换机连接两路IPTV"
date: 2012-02-20 14:43
comments: true
categories: 
- 技术
- 生活
---

上海电信的IPTV通道和互联网通道是通过ethernet的tag进行区分，然后达到控制各自流量的目的。这个tag打还是不打是有连接路由器的哪一个端口决定的。比如设定端口1和2是iptv的端口，
那么电信的一体猫或者网关就会给在这个口子进入的数据打上tag 51，当从这个口子的数据传给机顶盒时又要去掉tag。因为机顶盒本身是不会处理带tag的数据包的。

但是，我们普通家用的路由器或交换机是不会带有打tag区分vlan的功能。这就是为什么自己家庭的路由器直接连光猫或adsl后就只有iptv能用，或者只有互联网能接通。
要想iptv和互联网都能用，要么改造自己的猫，要么就继续用电信的路由器。

对我来说，是用自己的路由器接电信的上网端口3实现上网，用交换机接电信的iptv端口2实现iptv连接，其实这时候交换机就起到了一种vlan的作用。
这种架构也是一种被逼无奈。因为这边主要使用一体猫，而我的光猫又是放在门外的弱电井中 ，中间通过一根以太网网线连接。而这根网线已经在当两根网线在用，一根连路由器，一根连iptv机顶盒。
所以再装一路高清的话，就没有线路了。这根网线是预埋的，没有第二根线可以连到弱电井。

通过上面的办法，机顶盒可以直接连接自己的交换机，这样就实现了iptv端口2的共享。而这个共享至少到目前为止，上海电信还没有加以限制。如果电信调整了vlan等参数，可能会需要加以变化，但基本的原理
仍然是vlan id。最极端的情况，就是自己买一个千兆路由器，更换成openwrt固件后，自己直接打开vlan进行设置。这样就达到了同采用电信网关一模一样的效果。